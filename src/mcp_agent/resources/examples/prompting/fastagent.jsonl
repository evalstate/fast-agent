{"level":"ERROR","timestamp":"2025-03-16T11:51:17.742798","namespace":"mcp_agent.workflows.llm.augmented_llm_openai.Agent","message":"Error saving history: 1 validation error for PromptMessageMultipart\nrole\n  Input should be 'user' or 'assistant' [type=literal_error, input_value='system', input_type=str]\n    For further information visit https://errors.pydantic.dev/2.10/v/literal_error"}
{"level":"ERROR","timestamp":"2025-03-16T13:01:41.748470","namespace":"mcp_agent.workflows.llm.augmented_llm_anthropic","message":"Error saving history: cannot import name 'multipart_messages_to_delimited_format' from 'mcp_agent.mcp.prompt_message_multipart' (/home/ssmith/source/fast-agent/src/mcp_agent/mcp/prompt_message_multipart.py)"}
{"level":"ERROR","timestamp":"2025-03-19T13:58:18.481972","namespace":"mcp_agent.workflows.llm.augmented_llm_anthropic","message":"Error: Error code: 400 - {'type': 'error', 'error': {'type': 'invalid_request_error', 'message': \"messages.2.content.0.tool_result.content.0: Input tag 'document' found using 'type' does not match any of the expected tags: 'text', 'image'\"}}","data":{"data":[{"request":{"method":"POST","url":{"_uri_reference":["https","","api.anthropic.com",null,"/v1/messages",null,null]},"headers":["host","accept-encoding","connection","x-stainless-timeout","accept","content-type","user-agent","x-stainless-lang","x-stainless-package-version","x-stainless-os","x-stainless-arch","x-stainless-runtime","x-stainless-runtime-version","x-api-key","x-stainless-async","anthropic-version","x-stainless-retry-count","x-stainless-read-timeout","content-length"],"extensions":{"timeout":{"connect":5.0,"read":600,"write":"600","pool":"600"}},"stream":[{"capitalize":"<callable: capitalize>","center":"<callable: center>","count":"<callable: count>","decode":"<callable: decode>","endswith":"<callable: endswith>","expandtabs":"<callable: expandtabs>","find":"<callable: find>","fromhex":"<callable: fromhex>","hex":"<callable: hex>","index":"<callable: index>","isalnum":"<callable: isalnum>","isalpha":"<callable: isalpha>","isascii":"<callable: isascii>","isdigit":"<callable: isdigit>","islower":"<callable: islower>","isspace":"<callable: isspace>","istitle":"<callable: istitle>","isupper":"<callable: isupper>","join":"<callable: join>","ljust":"<callable: ljust>","lower":"<callable: lower>","lstrip":"<callable: lstrip>","maketrans":"<callable: maketrans>","partition":"<callable: partition>","removeprefix":"<callable: removeprefix>","removesuffix":"<callable: removesuffix>","replace":"<callable: replace>","rfind":"<callable: rfind>","rindex":"<callable: rindex>","rjust":"<callable: rjust>","rpartition":"<callable: rpartition>","rsplit":"<callable: rsplit>","rstrip":"<callable: rstrip>","split":"<callable: split>","splitlines":"<callable: splitlines>","startswith":"<callable: startswith>","strip":"<callable: strip>","swapcase":"<callable: swapcase>","title":"<callable: title>","translate":"<callable: translate>","upper":"<callable: upper>","zfill":"<callable: zfill>"}],"_content":"b'{\"max_tokens\":2048,\"messages\":[{\"role\":\"user\",\"content\":\"what files are available\"},{\"role\":\"assistant\",\"content\":[{\"type\":\"text\",\"text\":\"I\\'ll help you check the available files by using the hfspace-available-files tool to list the resources. Here\\'s the function call:\"},{\"type\":\"tool_use\",\"name\":\"hfspace-available-files\",\"input\":{},\"id\":\"toolu_01VXmYNR9nVoYyajsZATA1yM\"}]},{\"role\":\"user\",\"content\":[{\"type\":\"tool_result\",\"tool_use_id\":\"toolu_01VXmYNR9nVoYyajsZATA1yM\",\"content\":[{\"type\":\"document\",\"title\":\"available-files\",\"source\":{\"type\":\"text\",\"media_type\":\"text/plain\",\"data\":\"The following resources are available for tool calls:\\\\n| Resource URI | Name | MIME Type | Size | Last Modified |\\\\n|--------------|------|-----------|------|---------------|\\\\n| file:./__init__.py | __init__.py | application/octet-stream | 49.0 B | 2025-03-15T13:36:41.737Z |\\\\n| file:./agent.py | agent.py | application/octet-stream | 1.1 KB | 2025-03-19T13:12:01.842Z |\\\\n| file:./delimited_prompt.txt | delimited_prompt.txt | text/plain | 305.0 B | 2025-03-15T13:42:53.387Z |\\\\n| file:./fastagent.config.yaml | fastagent.config.yaml | text/yaml | 1.2 KB | 2025-03-19T13:12:01.842Z |\\\\n| file:./fastagent.jsonl | fastagent.jsonl | application/octet-stream | 734.0 B | 2025-03-18T16:13:24.481Z |\\\\n| file:./foo.md | foo.md | text/markdown | 148.0 B | 2025-03-18T16:13:24.481Z |\\\\n| file:./image.jpg | image.jpg | image/jpeg | 21.5 KB | 2025-03-17T09:11:15.463Z |\\\\n| file:./image.png | image.png | image/png | 27.9 KB | 2025-03-17T09:11:15.463Z |\\\\n| file:./image_server.py | image_server.py | application/octet-stream | 1.7 KB | 2025-03-19T13:12:01.842Z |\\\\n| file:./long_chat.md | long_chat.md | text/markdown | 39.7 KB | 2025-03-18T16:13:24.481Z |\\\\n| file:./persist.md | persist.md | text/markdown | 6.5 KB | 2025-03-18T16:13:24.481Z |\\\\n| file:./prompt1.txt | prompt1.txt | text/plain | 64.0 B | 2025-03-15T13:21:30.626Z |\\\\n| file:./prompt2.md | prompt2.md | text/markdown | 78.0 B | 2025-03-15T13:24:37.492Z |\\\\n| file:./resource-exe.md | resource-exe.md | text/markdown | 115.0 B | 2025-03-19T13:12:01.852Z |\\\\n| file:./resource.md | resource.md | text/markdown | 319.0 B | 2025-03-19T13:12:01.852Z |\\\\n| file:./sample.css | sample.css | text/css | 1.5 KB | 2025-03-15T14:23:44.731Z |\\\\n| file:./sizing.md | sizing.md | text/markdown | 248.0 B | 2025-03-15T13:59:55.718Z |\\\\n| file:./test.exe | test.exe | application/octet-stream | 21.5 KB | 2025-03-19T13:12:01.852Z |\\\\n| file:./testingagain.md | testingagain.md | text/markdown | 39.4 KB | 2025-03-18T16:13:24.481Z |\\\\n| file:./__pycache__/__init__.cpython-312.pyc | __init__.cpython-312.pyc | application/octet-stream | 242.0 B | 2025-03-15T13:36:47.217Z |\\\\n| file:./__pycache__/__init__.cpython-313.pyc | __init__.cpython-313.pyc | application/octet-stream | 242.0 B | 2025-03-15T17:23:14.002Z |\\\\n| file:./__pycache__/prompt_server_v2.cpython-312.pyc | prompt_server_v2.cpython-312.pyc | application/octet-stream | 15.5 KB | 2025-03-15T13:38:41.316Z |\\\\n| file:./__pycache__/prompt_template.cpython-312.pyc | prompt_template.cpython-312.pyc | application/octet-stream | 11.2 KB | 2025-03-15T15:15:51.293Z |\\\\n| file:./__pycache__/prompt_template.cpython-313.pyc | prompt_template.cpython-313.pyc | application/octet-stream | 11.3 KB | 2025-03-15T17:23:14.002Z |\\\\n\\\\nPrefer using the Resource URI for tool parameters which require a file input. URLs are also accepted.\"}}],\"is_error\":false}]}],\"model\":\"claude-3-5-haiku-latest\",\"stop_sequences\":null,\"system\":\"You are a helpful AI Agent\",\"tools\":[{\"name\":\"image-get_image\",\"description\":\"Returns an image with a descriptive text\",\"input_schema\":{\"properties\":{\"image_name\":{\"default\":\"default\",\"title\":\"Image Name\",\"type\":\"string\"}},\"title\":\"get_imageArguments\",\"type\":\"object\"}},{\"name\":\"hfspace-available-files\",\"description\":\"A list of available file and resources. If the User requests things like \\'most recent image\\' or \\'the audio\\' use this tool to identify the intended resource.This tool returns \\'resource uri\\', \\'name\\', \\'size\\', \\'last modified\\'  and \\'mime type\\' in a markdown table\",\"input_schema\":{\"type\":\"object\",\"properties\":{}}},{\"name\":\"hfspace-FLUX_1-schnell-infer\",\"description\":\"Call the FLUX.1-schnell endpoint /infer\",\"input_schema\":{\"type\":\"object\",\"properties\":{\"prompt\":{\"type\":\"string\",\"description\":\"Prompt\",\"examples\":[\"Hello!!\"]},\"seed\":{\"type\":\"number\",\"description\":\"Seed\",\"default\":0},\"randomize_seed\":{\"type\":\"boolean\",\"description\":\"Randomize seed\",\"default\":true,\"examples\":[true]},\"width\":{\"type\":\"number\",\"description\":\"Width\",\"default\":1024,\"examples\":[256]},\"height\":{\"type\":\"number\",\"description\":\"Height\",\"default\":1024,\"examples\":[256]},\"num_inference_steps\":{\"type\":\"number\",\"description\":\"Number of inference steps\",\"default\":4,\"examples\":[1]}},\"required\":[\"prompt\"]}}]}'"},"message":"Error code: 400 - {'type': 'error', 'error': {'type': 'invalid_request_error', 'message': \"messages.2.content.0.tool_result.content.0: Input tag 'document' found using 'type' does not match any of the expected tags: 'text', 'image'\"}}","body":{"type":"error","error":{"type":"invalid_request_error","message":"messages.2.content.0.tool_result.content.0: Input tag 'document' found using 'type' does not match any of the expected tags: 'text', 'image'"}},"response":"<httpx.Response [400] https://api.anthropic.com/v1/messages>","status_code":400,"request_id":"req_01SSWGVnQqTqqRV97fAdqhJb"}]}}
